# 🌊 FileFlow Bridge 使用指南

`FileFlow Bridge` 是一款高性能的文件流转桥接工具。它采用 **“边传边下” (Streaming Bridge)** 技术，打破了传统中转服务器“先完整上传、再分发下载”的模式，实现零等待的即时文件分发。

---

## 🚀 核心特性

* **零时延分发**：文件注册后立即获取下载链接，无需等待上传完成。
* **内存友好**：数据在 TCP 隧道与 HTTP 响应间实时透传，不占用服务器磁盘。
* **极简配置**：支持命令行参数与环境变量，配置灵活。

---

## 🌐 公共节点 (Quick Start)
为了方便快速测试，你可以直接使用我们维护的公共演示节点，无需自行部署服务端：

* 公共`Bridge`地址: https://ffb.soocoo.xyz

* 用法示例:
    ```
    ./fileflowprovider https://ffb.soocoo.xyz ./你的文件.zip
    ```

---

## 🛠️ 服务端部署 (Bridge Server)

服务端负责协调连接并提供 HTTP 访问入口。

### 1. 运行二进制文件

你可以直接运行预编译的二进制文件：

```bash
./fileflowbridge --http-port=8000 --tcp-port=8888 --max-file-size=100 --token-len=16
```

### 2. 配置优先级

程序按以下优先级读取配置：**命令行参数 > 环境变量 > 默认值**。

| 配置项 | 命令行参数 | 环境变量 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| **HTTP 端口** | `--http-port` | `FFB_HTTP_PORT` | `8000` | 对外提供访问与下载的 **HTTP** 端口 |
| **TCP 端口** | `--tcp-port` | `FFB_TCP_PORT` | `8888` | 接收文件流推送的内网/外网 TCP 端口 |
| **最大文件限制** | `--max-file-size` | `FFB_MAX_FILE_SIZE` | `100` | 允许注册的最大文件大小 (**单位: GiB**) |
| **AuthToken 长度** | `--token-len` | `FFB_TOKEN_LEN` | `8` | 注册时生成的 **AuthToken** 长度，长度越长安全性越高，长度范围6-32位，超出限制将改成默认8位 |

---

## 📤 提供端使用 (File Provider)

提供端用于将本地文件“映射”到云端，并通过流方式推送数据。

### 使用方法

在命令行中依次指定 **服务端完整 HTTP 地址** 和 **本地文件路径**：

```bash
./fileflowprovider http://<IP或域名>:<端口> <文件路径>
```

> **注意**：服务端地址必须包含 `http://` 前缀及明确的端口号。

**示例：**

```bash
# 假设服务端运行在 1.2.3.4 的 8000 端口
./fileflowprovide http://1.2.3.4:8000 /home/data/large_video.mp4
```

### 执行流程

1. **注册**：向服务端申请文件认证令牌。
2. **生成链接**：终端输出唯一的 HTTP 下载地址。
3. **流式传输**：当有人访问下载地址时，提供端会立即通过 TCP 隧道向服务端推送数据。

---

## 📖 运行示例 (Demo)
当你运行`fileflowprovider`后，程序会立即返回一个下载链接。你只需将该链接发送给接收者，对方点击即可开始下载。

```
[root@test ~]# ./fileflowprovider https://ffb.soocoo.xyz test_file
📝 注册文件中...
📁 原始文件名: test_file
🔗 点击或双击复制下载地址:
https://ffb.soocoo.xyz/download/hU50yWYu/test_file

# --- 此时，接收者在浏览器打开上述链接，传输会自动开始 ---

🔗 建立流连接...
✅ 流连接已建立，开始传输文件...
📤 上传中 [==================================================] 100.0% (100.00 MiB / 100.00 MiB)
📊 传输统计: 100.00 MiB, 耗时 5.00 秒, 平均速度: 19.99 MiB/s
🎉 文件传输完成!

============================================================

📥 下载信息:

• 文件名称: test_file
• 文件大小: 100.00 MiB
• 下载URL: https://ffb.soocoo.xyz/download/hU50yWYu/test_file
• 有效时间: 下载完成后自动失效

💡 提示: 请确保发送端保持运行，直到下载完成。

============================================================
✅ 操作完成! 文件已准备好下载
💡 注意: 文件下载完成后，下载链接将自动失效
```

---

## ⚠️ 注意事项

* **单次有效**：为保证传输性能与安全，下载地址在完成后立即失效，资源自动释放。
* **不支持断点续传**：由于采用实时流物理透传，下载过程中断需重新发起注册。
* **防火墙策略**：请确保服务端定义的 `HTTP 端口` 和 `TCP 端口` 在防火墙或安全组中已开放。
* **安全性**：`AuthToken` 是 File Provider 连接 Bridge Server 进行流传输的唯一凭证。增加 `--token-len` 可以有效防止暴力破解
